import React, { Fragment, useState } from "react";
import { Collapse, Toolbar } from "@mui/material";
import { useLocation } from "react-router-dom";
import ListSubheader from "../../Data Display/List/ListSubheader";
import List from "../../Data Display/List/List";
import { PAGELIST } from "../../../config/pageList";
import { PAGESECTIONS } from "../../../config/pageSections";
import NavItem from "./NavItem";
import SubmenuItem from "./SubmenuItem";

const SideBarNavHelpers = ({ open, handleDrawerOpen }) => {
  const [openSections, setOpenSections] = useState({});
  const [anchorEl, setAnchorEl] = useState(null);
  const { pathname } = useLocation();

  const handleClick = (section) => {
    setOpenSections((prev) => ({
      ...prev,
      [section]: !openSections[section],
    }));
    setAnchorEl(section.currentTarget);
  };

  return (
    <List sx={open ? { padding: "24px" } : { padding: "6px" }}>
      <Toolbar sx={{ justifyContent: "center" }}>
        <img src="/logo/NMS Logo.svg" alt="" />
      </Toolbar>
      {PAGESECTIONS.map((section) => (
        <Fragment key={section.title}>
          {open ? <ListSubheader >{section.title}</ListSubheader> : null}
          {PAGELIST.filter((item) => item.section === section.section).map(
            (item) => (
              <Fragment key={item.title}>
                {/* START - THIS FOR SUBMENU ITEMS */}
                {item.groupBy ? (
                  <Fragment>
                    {open ? (
                      //FOR OPEN DRAWER ONLY
                      <>
                        {item?.isMain ? (
                          <SubmenuItem
                            item={item}
                            handleClick={handleClick}
                            openSections={{}}
                            useDropdown={true}
                            activeItem={pathname === item.path}
                          />
                        ) : (
                          <Fragment />
                        )}
                      </>
                    ) : (
                      //FOR CLOSED DRAWER ONLY (ICONS AND TITLE WILL DISPLAY, INSTEAD OF DROPDOWN IT WILL SHOW AS MENU)
                      <>
                        {item?.isMain ? (
                          <>
                            <SubmenuItem
                              item={item}
                              handleClick={handleDrawerOpen}
                              openSections={{}}
                              useDropdown={false}
                              activeItem={pathname === item.path}
                            />
                          </>
                        ) : (
                          <Fragment />
                        )}
                      </>
                    )}
                    {open ? (
                      <Collapse
                        in={openSections[item.submenu]}
                        timeout="auto"
                        unmountOnExit
                        mountOnEnter
                      >
                        {!item?.isMain ? (
                          <Fragment>
                            <NavItem
                              key={item.title}
                              title={item.title}
                              icon={item.icon}
                              path={item.path}
                              activeItem={pathname == item.path}
                            />
                          </Fragment>
                        ) : (
                          <Fragment />
                        )}
                      </Collapse>
                    ) : (
                      //CHANGE THIS TO A MENU
                      <Collapse
                        
                      >
                        {!item?.isMain ? (
                          <Fragment>
                            <NavItem
                              key={item.title}
                              title={item.title}
                              icon={item.icon}
                              path={item.path}
                              activeItem={pathname == item.path}
                            />
                          </Fragment>
                        ) : (
                          <Fragment />
                        )}
                      </Collapse>
                    )}
                  </Fragment>
                ) : (
                  /* START - THIS FOR NO SUBMENU ITEMS */
                  <>
                    {open ? (
                      //FOR OPEN DRAWER ONLY (DEFAULT)
                      <Fragment>
                        <NavItem
                          key={item.title}
                          title={item.title}
                          icon={item.icon}
                          path={item.path}
                          activeItem={pathname == item.path}
                        />
                      </Fragment>
                    ) : (
                      //FOR CLOSED DRAWER ONLY (ICONS AND TITLE WILL DISPLAY)
                      <>
                        <NavItem
                          key={item.title}
                          title={item.title}
                          icon={item.icon}
                          path={item.path}
                          activeItem={pathname == item.path}
                          open={!open}
                        />
                      </>
                    )}
                  </>
                )}
              </Fragment>
              
            )
          )}
        </Fragment>
      ))}
    </List>
  );
};

export default SideBarNavHelpers;